<!DOCTYPE html>
<html lang="en">
  <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="shortcut icon" href="https://oci-development.github.io/images/oci-icon-t-white.png" type="image/png">
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
      <title>OCI | Orbital Debris Cleanup</title>
      <style>
          :root {
              --primary-color: #005ea5;
              --primary-dark: #003d75;
              --success-color: #00703c;
              --warning-color: #f47738;
              --danger-color: #d4351c;
              --text-color: #0b0c0c;
              --bg-color: #f3f2f1;
              --card-bg: #ffffff;
              --border-color: #b1b4b6;
              --space-bg: linear-gradient(135deg, #0c1445 0%, #1a1a2e 50%, #16213e 100%);
          }
  
          * {
              margin: 0;
              padding: 0;
              box-sizing: border-box;
          }
  
          body {
              font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
              background: var(--space-bg);
              color: #ffffff;
              min-height: 100vh;
              overflow-x: hidden;
          }
  
          .game-container {
              max-width: 1200px;
              margin: 0 auto;
              padding: 20px;
              position: relative;
          }
  
          .header {
              text-align: center;
              margin-bottom: 30px;
              padding: 20px;
              background: rgba(255, 255, 255, 0.1);
              border-radius: 15px;
              backdrop-filter: blur(10px);
          }
  
          .header h1 {
              font-size: 2.5em;
              margin-bottom: 10px;
              background: linear-gradient(45deg, #00d4ff, #7b68ee);
              -webkit-background-clip: text;
              -webkit-text-fill-color: transparent;
              background-clip: text;
          }
  
          .header p {
              opacity: 0.8;
              font-size: 1.1em;
          }
  
          .game-stats {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 20px;
              margin-bottom: 30px;
          }
  
          .stat-card {
              background: rgba(255, 255, 255, 0.1);
              padding: 20px;
              border-radius: 10px;
              text-align: center;
              backdrop-filter: blur(10px);
              border: 1px solid rgba(255, 255, 255, 0.2);
              transition: transform 0.3s ease;
          }
  
          .stat-card:hover {
              transform: translateY(-5px);
          }
  
          .stat-value {
              font-size: 2em;
              font-weight: bold;
              color: #00d4ff;
              display: block;
          }
  
          .stat-label {
              font-size: 0.9em;
              opacity: 0.8;
              margin-top: 5px;
          }
  
          .progress-bar {
              width: 100%;
              height: 8px;
              background: rgba(255, 255, 255, 0.2);
              border-radius: 4px;
              overflow: hidden;
              margin-top: 8px;
          }
  
          .progress-fill {
              height: 100%;
              background: linear-gradient(45deg, #00d4ff, #7b68ee);
              border-radius: 4px;
              transition: width 0.1s ease;
              box-shadow: 0 0 10px rgba(0, 212, 255, 0.5);
          }
  
          .game-area {
              display: grid;
              grid-template-columns: 1fr 300px;
              gap: 30px;
              margin-bottom: 30px;
          }
  
          .debris-field {
              background: rgba(0, 0, 0, 0.3);
              border-radius: 15px;
              padding: 30px;
              min-height: 400px;
              position: relative;
              overflow: hidden;
              border: 2px solid rgba(255, 255, 255, 0.1);
          }
  
          .debris-item {
              position: absolute;
              width: 30px;
              height: 30px;
              background: linear-gradient(45deg, #ff6b6b, #ee5a24);
              border-radius: 50%;
              transition: all 0.3s ease;
              animation: float 3s ease-in-out infinite;
              box-shadow: 0 0 20px rgba(255, 107, 107, 0.5);
              pointer-events: none; /* Make debris non-clickable */
          }
  
          .debris-item:hover {
              transform: scale(1.1);
              box-shadow: 0 0 25px rgba(255, 107, 107, 0.7);
          }
  
          @keyframes float {
              0%, 100% { transform: translateY(0px) rotate(0deg); }
              50% { transform: translateY(-10px) rotate(180deg); }
          }
  
          .debris-item.collected {
              animation: collect 0.5s ease-out forwards;
          }
  
          @keyframes collect {
              to {
                  transform: scale(0) rotate(360deg);
                  opacity: 0;
              }
          }
  
          .main-action {
              text-align: center;
              margin: 20px 0;
          }
  
          .collect-btn {
              background: linear-gradient(45deg, var(--primary-color), #00d4ff);
              color: white;
              border: none;
              padding: 20px 40px;
              font-size: 1.2em;
              font-weight: bold;
              border-radius: 50px;
              cursor: pointer;
              transition: all 0.3s ease;
              box-shadow: 0 5px 20px rgba(0, 212, 255, 0.3);
          }
  
          .collect-btn:hover:not(:disabled) {
              transform: translateY(-3px);
              box-shadow: 0 8px 25px rgba(0, 212, 255, 0.5);
          }
  
          .collect-btn:active:not(:disabled) {
              transform: translateY(0);
          }
  
          .collect-btn:disabled {
              background: linear-gradient(45deg, #666, #888);
              cursor: not-allowed;
              transform: none;
              box-shadow: none;
          }
  
          .debris-counter {
              position: absolute;
              top: 10px;
              right: 10px;
              background: rgba(255, 107, 107, 0.9);
              color: white;
              padding: 5px 10px;
              border-radius: 15px;
              font-weight: bold;
              font-size: 0.9em;
          }
  
          .game-clock {
              position: absolute;
              top: 10px;
              left: 10px;
              background: rgba(0, 212, 255, 0.9);
              color: white;
              padding: 5px 10px;
              border-radius: 15px;
              font-weight: bold;
              font-size: 0.9em;
              font-family: 'Courier New', monospace;
          }
  
          .debris-counter.danger {
              background: rgba(212, 53, 28, 0.9);
              animation: pulse 1s infinite;
          }
  
          @keyframes pulse {
              0%, 100% { transform: scale(1); }
              50% { transform: scale(1.1); }
          }
  
          .upgrades-panel {
              background: rgba(255, 255, 255, 0.1);
              border-radius: 15px;
              padding: 20px;
              backdrop-filter: blur(10px);
              border: 1px solid rgba(255, 255, 255, 0.2);
          }
  
          .upgrades-panel h3 {
              margin-bottom: 20px;
              text-align: center;
              color: #00d4ff;
          }
  
          .upgrade-item {
              background: rgba(255, 255, 255, 0.05);
              margin-bottom: 15px;
              padding: 15px;
              border-radius: 10px;
              border: 1px solid rgba(255, 255, 255, 0.1);
          }
  
          .upgrade-header {
              display: flex;
              justify-content: space-between;
              align-items: flex-start;
              margin-bottom: 10px;
              flex-direction: column;
          }
  
          .upgrade-name {
              font-weight: bold;
              font-size: 1.1em;
              margin-bottom: 5px;
          }
  
          .upgrade-level {
              background: var(--primary-color);
              color: white;
              padding: 2px 8px;
              border-radius: 12px;
              font-size: 0.8em;
              align-self: flex-start;
          }
  
          .upgrade-description {
              font-size: 0.9em;
              opacity: 0.8;
              margin-bottom: 10px;
          }
  
          .upgrade-btn {
              width: 100%;
              background: linear-gradient(45deg, var(--success-color), #00d4ff);
              color: white;
              border: none;
              padding: 10px;
              border-radius: 5px;
              cursor: pointer;
              font-weight: bold;
              transition: all 0.3s ease;
          }
  
          .upgrade-btn:hover {
              transform: translateY(-2px);
          }
  
          .upgrade-btn:disabled {
              background: #666;
              cursor: not-allowed;
              transform: none;
          }
  
          .controls {
              display: grid;
              grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
              gap: 20px;
              margin-top: 30px;
          }
  
          .control-btn {
              background: rgba(255, 255, 255, 0.1);
              color: white;
              border: 1px solid rgba(255, 255, 255, 0.3);
              padding: 15px 20px;
              border-radius: 10px;
              cursor: pointer;
              font-weight: bold;
              transition: all 0.3s ease;
              backdrop-filter: blur(10px);
          }
  
          .control-btn:hover {
              background: rgba(255, 255, 255, 0.2);
              transform: translateY(-2px);
          }
  
          .control-btn.prestige {
              background: linear-gradient(45deg, #ff6b6b, #ffa726);
          }
  
          .control-btn.save {
              background: linear-gradient(45deg, var(--success-color), #4caf50);
          }
  
          .control-btn.load {
              background: linear-gradient(45deg, var(--primary-color), #2196f3);
          }
  
          .prestige-info {
              background: rgba(255, 107, 107, 0.1);
              border: 1px solid rgba(255, 107, 107, 0.3);
              padding: 20px;
              border-radius: 10px;
              margin-top: 20px;
              text-align: center;
          }
  
          .file-input {
              display: none;
          }
  
          .particles {
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              pointer-events: none;
              z-index: -1;
          }
  
          .particle {
              position: absolute;
              width: 2px;
              height: 2px;
              background: rgba(255, 255, 255, 0.5);
              border-radius: 50%;
              animation: twinkle 2s ease-in-out infinite;
          }
  
          @keyframes twinkle {
              0%, 100% { opacity: 0; transform: scale(0); }
              50% { opacity: 1; transform: scale(1); }
          }
  
          @keyframes floatUp {
              0% {
                  transform: translateY(0) scale(1);
                  opacity: 1;
              }
              100% {
                  transform: translateY(-50px) scale(1.2);
                  opacity: 0;
              }
          }
  
          @media (max-width: 768px) {
              .game-area {
                  grid-template-columns: 1fr;
                  gap: 20px;
              }
              
              .header h1 {
                  font-size: 1.8em;
              }
              
              .header p {
                  font-size: 0.9em;
              }
              
              .collect-btn {
                  padding: 15px 25px;
                  font-size: 1em;
              }
              
              .game-stats {
                  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                  gap: 15px;
              }
              
              .stat-value {
                  font-size: 1.5em;
              }
              
              .debris-field {
                  padding: 20px;
                  min-height: 300px;
              }
              
              .upgrades-panel {
                  padding: 15px;
              }
              
              .upgrade-item {
                  padding: 12px;
              }
              
              .controls {
                  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                  gap: 15px;
              }
              
              .control-btn {
                  padding: 12px 15px;
                  font-size: 0.9em;
              }
              
              .prestige-info {
                  padding: 15px;
                  margin-top: 15px;
              }
              
              .modal-content {
                  width: 95%;
                  margin: 5% auto;
                  padding: 20px;
              }
              
              .achievement-popup {
                  right: 10px;
                  top: 10px;
                  padding: 12px 15px;
                  font-size: 0.9em;
              }
          }
          
          @media (max-width: 480px) {
              .header h1 {
                  font-size: 1.5em;
              }
              
              .game-stats {
                  grid-template-columns: 1fr 1fr;
              }
              
              .collect-btn {
                  padding: 12px 20px;
                  font-size: 0.9em;
              }
              
              .debris-field {
                  padding: 15px;
                  min-height: 250px;
              }
              
              .game-clock, .debris-counter {
                  font-size: 0.8em;
                  padding: 4px 8px;
              }
              
              .controls {
                  grid-template-columns: 1fr;
              }
              
              .modal-content {
                  padding: 15px;
              }
          }
  
          .achievement-popup {
              position: fixed;
              top: 20px;
              right: 20px;
              background: linear-gradient(45deg, #4caf50, #00d4ff);
              color: white;
              padding: 15px 20px;
              border-radius: 10px;
              transform: translateX(400px);
              transition: transform 0.5s ease;
              z-index: 1000;
              box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
          }
  
          .achievement-popup.show {
              transform: translateX(0);
          }
  
          .modal {
              display: none;
              position: fixed;
              top: 0;
              left: 0;
              width: 100%;
              height: 100%;
              background: rgba(0, 0, 0, 0.8);
              z-index: 1000;
              backdrop-filter: blur(5px);
          }
  
          .modal-content {
              background: linear-gradient(135deg, #1a1a2e, #16213e);
              margin: 10% auto;
              padding: 30px;
              border-radius: 15px;
              width: 90%;
              max-width: 500px;
              border: 1px solid rgba(255, 255, 255, 0.2);
              text-align: center;
          }
  
          .modal h3 {
              color: #00d4ff;
              margin-bottom: 20px;
          }
  
          .modal-buttons {
              display: flex;
              gap: 15px;
              justify-content: center;
              margin-top: 25px;
          }
  
          .modal-btn {
              padding: 10px 20px;
              border: none;
              border-radius: 5px;
              cursor: pointer;
              font-weight: bold;
              transition: all 0.3s ease;
          }
  
          .modal-btn.confirm {
              background: linear-gradient(45deg, #ff6b6b, #ffa726);
              color: white;
          }
  
          .modal-btn.cancel {
              background: #666;
              color: white;
          }
  
          .modal-btn:hover {
              transform: translateY(-2px);
          }
      </style>
  </head>
  <body>
      <div class="particles" id="particles"></div>
      
      <div class="game-container">
          <header class="header">
              <h1><i class="fas fa-satellite"></i> Orbital Debris Cleanup</h1>
              <p>Help clean up space debris and make orbital access safer for everyone!</p>
          </header>
  
          <div class="game-stats">
              <div class="stat-card">
                  <span class="stat-value" id="debrisCount">0</span>
                  <div class="stat-label">Debris Collected</div>
              </div>
              <div class="stat-card" id="autoCollectorCard" style="display: none;">
                  <div class="stat-label" style="margin-bottom: 10px;"><i class="fas fa-robot"></i> Auto Collector</div>
                  <div class="progress-bar">
                      <div class="progress-fill" id="autoCollectorProgress"></div>
                  </div>
                  <div class="stat-label" id="autoCollectorStatus" style="margin-top: 5px; font-size: 0.8em;">Ready</div>
              </div>
              <div class="stat-card">
                  <span class="stat-value" id="totalCleanup">0</span>
                  <div class="stat-label">Total Cleanup Score</div>
              </div>
              <div class="stat-card">
                  <span class="stat-value" id="prestigeLevel">0</span>
                  <div class="stat-label">Prestige Level</div>
              </div>
          </div>
  
          <div class="game-area">
              <div class="debris-field" id="debrisField">
                  <div class="game-clock" id="gameClock">00:00:00</div>
                  <div class="debris-counter" id="debrisCounter">Debris: 0/20</div>
                  <div class="main-action">
                      <button class="collect-btn" id="collectBtn" disabled><i class="fas fa-broom"></i> Collect Debris</button>
                  </div>
              </div>
  
              <div class="upgrades-panel">
                  <h3><i class="fas fa-cogs"></i> Cleanup Upgrades</h3>
                  <div id="upgradesList"></div>
              </div>
          </div>
  
          <div class="controls">
              <button class="control-btn prestige" id="prestigeBtn"><i class="fas fa-star"></i> Prestige Reset</button>
              <button class="control-btn save" id="saveBtn"><i class="fas fa-save"></i> Save Progress</button>
              <button class="control-btn load" id="loadBtn"><i class="fas fa-folder-open"></i> Load Progress</button>
              <button class="control-btn" onclick="location.href='/#insight'"><i class="fas fa-home"></i> Back to OCI</button>
          </div>
  
          <div class="prestige-info" id="prestigeInfo" style="display: none;">
              <p><strong><i class="fas fa-star"></i> Ready to Prestige!</strong></p>
              <p>You can reset your progress for a <span id="prestigeBonus">0</span>% permanent bonus to debris collection!</p>
              <p style="margin-top: 10px; font-size: 0.9em; opacity: 0.8;">
                  <strong>Next prestige requirement:</strong> <span id="nextPrestigeThreshold">20,000</span> total debris collected
              </p>
          </div>
      </div>
  
      <input type="file" id="fileInput" class="file-input" accept=".ocif">
  
      <div class="achievement-popup" id="achievementPopup">
          <div id="achievementText"></div>
      </div>
  
      <!-- Kessler Syndrome Game Over Modal -->
      <div class="modal" id="kesslerModal">
          <div class="modal-content" style="border: 2px solid #d4351c; background: linear-gradient(135deg, #2d1b1b, #3d1a1a);">
              <h3 style="color: #ff6b6b;"><i class="fas fa-skull"></i> KESSLER SYNDROME</h3>
              <p style="margin: 15px 0; font-size: 1.1em;">The debris field has become too dense! Cascading collisions have made orbital space inaccessible.</p>
              <div style="background: rgba(255, 107, 107, 0.1); padding: 15px; border-radius: 10px; margin: 20px 0;">
                  <p><strong>Final Stats:</strong></p>
                  <p>• Total Debris Collected: <span id="finalDebrisCount">0</span></p>
                  <p>• Prestige Level: <span id="finalPrestigeLevel">0</span></p>
                  <p>• Time Survived: <span id="survivalTime">0</span> seconds</p>
              </div>
              <p style="font-size: 0.9em; opacity: 0.8;">In reality, Kessler Syndrome could make space exploration extremely dangerous. Your mission to clean up orbital debris is more important than ever!</p>
              <div class="modal-buttons">
                  <button class="modal-btn confirm" id="restartGame"><i class="fas fa-redo"></i> Restart Mission</button>
                  <button class="modal-btn cancel" onclick="location.href='/#insight'"><i class="fas fa-home"></i> Return to OCI</button>
              </div>
          </div>
      </div>
  
      <!-- Prestige Confirmation Modal -->
      <div class="modal" id="prestigeModal">
          <div class="modal-content">
              <h3><i class="fas fa-star"></i> Prestige Reset</h3>
              <p>Are you sure you want to prestige? This will:</p>
              <ul style="text-align: left; margin: 15px 0;">
                  <li>Reset all your debris and upgrades</li>
                  <li>Give you a permanent <span id="modalPrestigeBonus">0</span>% collection bonus</li>
                  <li>Increase your prestige level</li>
              </ul>
              <div class="modal-buttons">
                  <button class="modal-btn confirm" id="confirmPrestige">Yes, Prestige!</button>
                  <button class="modal-btn cancel" id="cancelPrestige">Cancel</button>
              </div>
          </div>
      </div>
  
      <script>
          let gameState = {
              debris: 0,
              totalDebris: 0,
              prestigeLevel: 0,
              prestigeBonus: 0,
              spawnedDebris: 0,
              maxDebrisLimit: 30,
              gameStartTime: Date.now(),
              lastAutoCollect: 0,
              autoCollectorCooldown: 0,
              autoCollectorMaxCooldown: 0,
              upgrades: {
                  collector: { level: 0, baseCost: 10, multiplier: 1.5 },
                  autoCollector: { level: 0, baseCost: 100, multiplier: 2 },
                  efficiency: { level: 0, baseCost: 500, multiplier: 2.5 },
                  scanner: { level: 0, baseCost: 1000, multiplier: 3 }
              },
              achievements: new Set(),
              lastSave: Date.now(),
              gameOver: false
          };
  
          const upgradeDefinitions = {
              collector: {
                  name: "Manual Collector",
                  description: "Increases debris per click",
                  effect: (level) => 1 + level,
                  icon: "fas fa-wrench"
              },
              autoCollector: {
                  name: "Auto Collector",
                  description: "Automatically collects spawned debris (reduces cooldown)",
                  effect: (level) => Math.max(1, 6 - level),
                  icon: "fas fa-robot"
              },
              efficiency: {
                  name: "Collection Efficiency",
                  description: "Multiplies all collection",
                  effect: (level) => 1 + (level * 0.5),
                  icon: "fas fa-bolt"
              },
              scanner: {
                  name: "Debris Scanner",
                  description: "Finds more debris in space",
                  effect: (level) => level * 2,
                  icon: "fas fa-satellite-dish"
              }
          };
  
          const achievements = {
              firstDebris: { name: "First Cleanup", description: "Collect your first piece of debris", threshold: 1 },
              hundred: { name: "Century Cleaner", description: "Collect 100 pieces of debris", threshold: 100 },
              thousand: { name: "Millennium Cleaner", description: "Collect 1,000 pieces of debris", threshold: 1000 },
              tenThousand: { name: "Space Janitor", description: "Collect 10,000 pieces of debris", threshold: 10000 },
              hundredThousand: { name: "Orbital Guardian", description: "Collect 100,000 pieces of debris", threshold: 100000 },
              firstUpgrade: { name: "Getting Better", description: "Purchase your first upgrade", threshold: 1 },
              firstPrestige: { name: "Rising Star", description: "Prestige for the first time", threshold: 1 }
          };
  
          function initGame() {
              loadGame();
              createParticles();
              updateDisplay();
              renderUpgrades();
              
              window.gameInterval = setInterval(autoCollect, 100);
              window.displayInterval = setInterval(updateDisplay, 100);
              window.spawnInterval = setInterval(spawnDebris, 2000);
              
              document.getElementById('collectBtn').addEventListener('click', collectDebris);
              document.getElementById('prestigeBtn').addEventListener('click', showPrestigeModal);
              document.getElementById('saveBtn').addEventListener('click', saveGame);
              document.getElementById('loadBtn').addEventListener('click', () => document.getElementById('fileInput').click());
              document.getElementById('fileInput').addEventListener('change', loadGameFromFile);
              document.getElementById('confirmPrestige').addEventListener('click', prestige);
              document.getElementById('cancelPrestige').addEventListener('click', hidePrestigeModal);
              document.getElementById('restartGame').addEventListener('click', restartGame);
          }
  
          function collectDebris() {
              if (gameState.spawnedDebris <= 0 || gameState.gameOver) return;
              
              const debrisItems = document.querySelectorAll('.debris-item:not(.collected)');
              if (debrisItems.length > 0 && gameState.spawnedDebris > 0) {
                  const firstDebris = debrisItems[0];
                  firstDebris.classList.add('collected');
                  
                  gameState.spawnedDebris = Math.max(0, gameState.spawnedDebris - 1);
                  
                  setTimeout(() => {
                      if (firstDebris.parentNode) {
                          firstDebris.remove();
                      }
                  }, 500);
                  
                  const baseAmount = upgradeDefinitions.collector.effect(gameState.upgrades.collector.level);
                  const efficiency = upgradeDefinitions.efficiency.effect(gameState.upgrades.efficiency.level);
                  const prestigeMultiplier = 1 + (gameState.prestigeBonus / 100);
                  const amount = Math.floor(baseAmount * efficiency * prestigeMultiplier);
                  
                  gameState.debris += amount;
                  gameState.totalDebris += amount;
                  
                  createCollectionEffect();
                  checkAchievements();
                  showCollectionFeedback(amount);
                  updateCollectButton();
                  updateDebrisCounter();
              }
          }
  
          function autoCollect() {
              if (gameState.gameOver) return;
              
              const currentTime = Date.now();
              const autoCollectorLevel = gameState.upgrades.autoCollector.level;
              
              if (autoCollectorLevel > 0 && gameState.spawnedDebris > 0) {
                  const cooldownSeconds = upgradeDefinitions.autoCollector.effect(autoCollectorLevel);
                  const cooldownMs = cooldownSeconds * 1000;
                  gameState.autoCollectorMaxCooldown = cooldownMs;
                  
                  const timeSinceLastCollect = currentTime - gameState.lastAutoCollect;
                  gameState.autoCollectorCooldown = Math.max(0, cooldownMs - timeSinceLastCollect);
                  
                  if (timeSinceLastCollect >= cooldownMs) {
                      const debrisItems = document.querySelectorAll('.debris-item:not(.collected)');
                      if (debrisItems.length > 0 && gameState.spawnedDebris > 0) {
                          const randomDebris = debrisItems[Math.floor(Math.random() * debrisItems.length)];
                          randomDebris.classList.add('collected');
                          
                          gameState.spawnedDebris = Math.max(0, gameState.spawnedDebris - 1);
                          
                          setTimeout(() => {
                              if (randomDebris.parentNode) {
                                  randomDebris.remove();
                              }
                          }, 500);
                          
                          const efficiency = upgradeDefinitions.efficiency.effect(gameState.upgrades.efficiency.level);
                          const prestigeMultiplier = 1 + (gameState.prestigeBonus / 100);
                          const amount = Math.floor(1 * efficiency * prestigeMultiplier);
                          
                          gameState.debris += amount;
                          gameState.totalDebris += amount;
                          
                          gameState.lastAutoCollect = currentTime;
                          gameState.autoCollectorCooldown = cooldownMs;
                          
                          checkAchievements();
                      }
                  }
              } else if (autoCollectorLevel > 0) {
                  const cooldownSeconds = upgradeDefinitions.autoCollector.effect(autoCollectorLevel);
                  const cooldownMs = cooldownSeconds * 1000;
                  gameState.autoCollectorMaxCooldown = cooldownMs;
                  
                  const timeSinceLastCollect = currentTime - gameState.lastAutoCollect;
                  gameState.autoCollectorCooldown = Math.max(0, cooldownMs - timeSinceLastCollect);
              } else {
                  gameState.autoCollectorCooldown = 0;
                  gameState.autoCollectorMaxCooldown = 0;
              }
          }
  
          function updateDisplay() {
              if (gameState.gameOver) return;
              
              document.getElementById('debrisCount').textContent = formatNumber(Math.floor(gameState.debris));
              document.getElementById('totalCleanup').textContent = formatNumber(Math.floor(gameState.totalDebris));
              document.getElementById('prestigeLevel').textContent = gameState.prestigeLevel;
              
              updateAutoCollectorProgress();
              updateGameClock();
              updateDebrisCounter();
              updateCollectButton();
              updateUpgradeButtons();
              
              const prestigeThreshold = 10000 * Math.pow(2, gameState.prestigeLevel);
              const nextPrestigeThreshold = 10000 * Math.pow(2, gameState.prestigeLevel + 1);
              
              document.getElementById('prestigeInfo').style.display = 'block';
              
              const progressPercent = Math.min(100, (gameState.debris / prestigeThreshold * 100));
              const displayPercent = progressPercent < 0.1 ? progressPercent.toFixed(2) : progressPercent.toFixed(1);
              const nextBonus = calculatePrestigeBonus();
              
              if (gameState.debris >= prestigeThreshold) {
                  document.getElementById('modalPrestigeBonus').textContent = nextBonus;
                  document.getElementById('nextPrestigeThreshold').textContent = formatNumber(nextPrestigeThreshold);
                  
                  const prestigeInfoElement = document.getElementById('prestigeInfo');
                  prestigeInfoElement.innerHTML = `
                      <p><strong><i class="fas fa-star"></i> Ready to Prestige!</strong></p>
                      <p>You can reset your progress for a <span style="color: #00d4ff; font-weight: bold;">${nextBonus}%</span> permanent bonus to debris collection!</p>
                      <div style="background: rgba(255, 255, 255, 0.2); border-radius: 10px; overflow: hidden; margin: 10px 0;">
                          <div style="background: linear-gradient(45deg, #00ff00, #32cd32); height: 8px; width: 100%; transition: width 0.3s ease; box-shadow: 0 0 15px rgba(0, 255, 0, 0.5);"></div>
                      </div>
                      <p style="font-size: 0.9em; opacity: 0.8;"><strong>Next prestige requirement:</strong> ${formatNumber(nextPrestigeThreshold)} current debris</p>
                  `;
              } else {
                  const prestigeInfoElement = document.getElementById('prestigeInfo');
                  prestigeInfoElement.innerHTML = `
                      <p><strong><i class="fas fa-fire"></i> Progress to Prestige ${gameState.prestigeLevel + 1}</strong></p>
                      <p>Collect <strong>${formatNumber(prestigeThreshold)}</strong> current debris to unlock prestige (+${nextBonus}% permanent bonus)</p>
                      <div style="background: rgba(255, 255, 255, 0.2); border-radius: 10px; overflow: hidden; margin: 10px 0;">
                          <div style="background: linear-gradient(45deg, #00d4ff, #7b68ee); height: 8px; width: ${progressPercent}%; transition: width 0.3s ease; min-width: 2px;"></div>
                      </div>
                      <p style="font-size: 0.9em; opacity: 0.8;">${formatNumber(gameState.debris)} / ${formatNumber(prestigeThreshold)} (${displayPercent}%)</p>
                  `;
              }
          }
  
          function updateGameClock() {
              const currentTime = Date.now();
              const elapsedTime = Math.floor((currentTime - gameState.gameStartTime) / 1000);
              
              const hours = Math.floor(elapsedTime / 3600);
              const minutes = Math.floor((elapsedTime % 3600) / 60);
              const seconds = elapsedTime % 60;
              
              const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
              document.getElementById('gameClock').textContent = timeString;
          }
  
          function updateDebrisCounter() {
              const counter = document.getElementById('debrisCounter');
              const current = Math.max(0, gameState.spawnedDebris);
              const max = gameState.maxDebrisLimit;
              
              counter.textContent = `Debris: ${current}/${max}`;
              
              if (current >= max * 0.8) {
                  counter.classList.add('danger');
              } else {
                  counter.classList.remove('danger');
              }
          }
  
          function updateCollectButton() {
              const button = document.getElementById('collectBtn');
              if (gameState.gameOver) {
                  button.disabled = true;
                  button.innerHTML = '<i class="fas fa-skull"></i> Game Over - Kessler Syndrome';
              } else if (gameState.spawnedDebris > 0) {
                  button.disabled = false;
                  button.innerHTML = `<i class="fas fa-broom"></i> Collect Debris (${Math.max(0, gameState.spawnedDebris)} available)`;
              } else {
                  button.disabled = true;
                  button.innerHTML = '<i class="fas fa-broom"></i> No Debris to Collect';
              }
          }
  
          function updateUpgradeButtons() {
              Object.keys(gameState.upgrades).forEach(upgradeKey => {
                  const cost = calculateUpgradeCost(upgradeKey);
                  const button = document.querySelector(`[onclick="purchaseUpgrade('${upgradeKey}')"]`);
                  if (button) {
                      if (gameState.debris >= cost) {
                          button.disabled = false;
                          button.textContent = `Buy for ${formatNumber(cost)} debris`;
                      } else {
                          button.disabled = true;
                          button.textContent = `Buy for ${formatNumber(cost)} debris`;
                      }
                  }
              });
          }
  
          function renderUpgrades() {
              const container = document.getElementById('upgradesList');
              container.innerHTML = '';
              
              Object.keys(gameState.upgrades).forEach(upgradeKey => {
                  const upgrade = gameState.upgrades[upgradeKey];
                  const definition = upgradeDefinitions[upgradeKey];
                  const cost = calculateUpgradeCost(upgradeKey);
                  
                  let effectDescription = '';
                  const currentEffect = upgradeDefinitions[upgradeKey].effect(upgrade.level);
                  const nextEffect = upgradeDefinitions[upgradeKey].effect(upgrade.level + 1);
                  
                  switch(upgradeKey) {
                      case 'collector':
                          effectDescription = upgrade.level > 0 ? 
                              `<br><small>Current: ${currentEffect} debris per click → Next: ${nextEffect}</small>` :
                              `<br><small>Next: ${nextEffect} debris per click</small>`;
                          break;
                      case 'autoCollector':
                          effectDescription = upgrade.level > 0 ? 
                              `<br><small>Current: ${currentEffect}s cooldown → Next: ${nextEffect}s</small>` :
                              `<br><small>Next: ${nextEffect}s auto-collection cooldown</small>`;
                          break;
                      case 'efficiency':
                          effectDescription = upgrade.level > 0 ? 
                              `<br><small>Current: ${(currentEffect).toFixed(1)}x multiplier → Next: ${(nextEffect).toFixed(1)}x</small>` :
                              `<br><small>Next: ${(nextEffect).toFixed(1)}x collection multiplier</small>`;
                          break;
                      case 'scanner':
                          effectDescription = upgrade.level > 0 ? 
                              `<br><small>Current: +${currentEffect} spawn rate → Next: +${nextEffect}</small>` :
                              `<br><small>Next: +${nextEffect} debris spawn rate</small>`;
                          break;
                  }
                  
                  const upgradeDiv = document.createElement('div');
                  upgradeDiv.className = 'upgrade-item';
                  
                  upgradeDiv.innerHTML = `
                      <div class="upgrade-header">
                          <span class="upgrade-name"><i class="${definition.icon}"></i> ${definition.name}</span>
                          <span class="upgrade-level">Level ${upgrade.level}</span>
                      </div>
                      <div class="upgrade-description">
                          ${definition.description}
                          ${effectDescription}
                      </div>
                      <button class="upgrade-btn" onclick="purchaseUpgrade('${upgradeKey}')" 
                              ${gameState.debris < cost ? 'disabled' : ''}>
                          Buy for ${formatNumber(cost)} debris
                      </button>
                  `;
                  
                  container.appendChild(upgradeDiv);
              });
          }
  
          function purchaseUpgrade(upgradeKey) {
              const cost = calculateUpgradeCost(upgradeKey);
              if (gameState.debris >= cost) {
                  gameState.debris -= cost;
                  gameState.upgrades[upgradeKey].level++;
                  renderUpgrades();
                  checkAchievements();
                  
                  const definition = upgradeDefinitions[upgradeKey];
                  showAchievement(`<i class="${definition.icon}"></i> Upgrade Purchased!`, `${definition.name} is now level ${gameState.upgrades[upgradeKey].level}`);
              }
          }
  
          function calculateUpgradeCost(upgradeKey) {
              const upgrade = gameState.upgrades[upgradeKey];
              return Math.floor(upgrade.baseCost * Math.pow(upgrade.multiplier, upgrade.level));
          }
  
          function calculatePrestigeBonus() {
              const baseBonus = 10;
              const prestigeMultiplier = gameState.prestigeLevel * 5;
              return baseBonus + prestigeMultiplier;
          }
  
          function showPrestigeModal() {
              const prestigeThreshold = 10000 * Math.pow(2, gameState.prestigeLevel);
              if (gameState.debris >= prestigeThreshold) {
                  document.getElementById('prestigeModal').style.display = 'block';
              }
          }
  
          function hidePrestigeModal() {
              document.getElementById('prestigeModal').style.display = 'none';
          }
  
          function prestige() {
              const bonus = calculatePrestigeBonus();
              gameState.prestigeBonus += bonus;
              gameState.prestigeLevel++;
              
              gameState.debris = 0;
              gameState.totalDebris = 0;
              gameState.autoCollectorCooldown = 0;
              gameState.autoCollectorMaxCooldown = 0;
              gameState.lastAutoCollect = 0;
              Object.keys(gameState.upgrades).forEach(key => {
                  gameState.upgrades[key].level = 0;
              });
              
              hidePrestigeModal();
              renderUpgrades();
              showAchievement("Prestige Achieved!", `+${bonus}% permanent bonus!`);
              checkAchievements();
          }
  
          function createCollectionEffect() {
              const btn = document.getElementById('collectBtn');
              btn.style.transform = 'scale(0.95)';
              setTimeout(() => {
                  btn.style.transform = 'scale(1)';
              }, 100);
          }
  
          function showCollectionFeedback(amount) {
              const btn = document.getElementById('collectBtn');
              const feedback = document.createElement('div');
              feedback.textContent = `+${formatNumber(amount)}`;
              feedback.style.cssText = `
                  position: absolute;
                  color: #00d4ff;
                  font-weight: bold;
                  font-size: 1.2em;
                  pointer-events: none;
                  z-index: 1000;
                  animation: floatUp 1s ease-out forwards;
              `;
              
              const rect = btn.getBoundingClientRect();
              feedback.style.left = (rect.left + rect.width/2) + 'px';
              feedback.style.top = (rect.top - 10) + 'px';
              
              document.body.appendChild(feedback);
              
              setTimeout(() => {
                  if (feedback.parentNode) {
                      feedback.parentNode.removeChild(feedback);
                  }
              }, 1000);
          }
  
          function spawnDebris() {
              if (gameState.gameOver) return;
              
              let spawnChance = 0.4;
              const autoCollectorLevel = gameState.upgrades.autoCollector.level;
              const scannerLevel = gameState.upgrades.scanner.level;
              
              spawnChance += (autoCollectorLevel * 0.1) + (scannerLevel * 0.05);
              spawnChance = Math.min(spawnChance, 0.8);
              
              if (Math.random() < spawnChance) {
                  const field = document.getElementById('debrisField');
                  const debris = document.createElement('div');
                  debris.className = 'debris-item';
                  debris.style.left = Math.random() * (field.offsetWidth - 30) + 'px';
                  debris.style.top = Math.random() * (field.offsetHeight - 100) + 60 + 'px';
                  debris.style.animationDelay = Math.random() * 2 + 's';
                  
                  field.appendChild(debris);
                  gameState.spawnedDebris++;
                  
                  if (gameState.spawnedDebris >= gameState.maxDebrisLimit) {
                      triggerKesslerSyndrome();
                  }
              }
          }
  
          function triggerKesslerSyndrome() {
              gameState.gameOver = true;
              
              clearInterval(window.gameInterval);
              clearInterval(window.displayInterval);
              clearInterval(window.spawnInterval);
              
              const collectBtn = document.getElementById('collectBtn');
              if (collectBtn) {
                  collectBtn.disabled = true;
                  collectBtn.innerHTML = '<i class="fas fa-skull"></i> Game Over - Kessler Syndrome';
              }
              
              setTimeout(() => {
                  showKesslerSyndromeModal();
              }, 1000);
          }
  
          function showKesslerSyndromeModal() {
              document.getElementById('finalDebrisCount').textContent = formatNumber(Math.floor(gameState.totalDebris));
              document.getElementById('finalPrestigeLevel').textContent = gameState.prestigeLevel;
              
              const survivalTime = Math.floor((Date.now() - gameState.lastSave) / 1000);
              document.getElementById('survivalTime').textContent = survivalTime;
              
              document.getElementById('kesslerModal').style.display = 'block';
          }
  
          function restartGame() {
              const preservedPrestige = gameState.prestigeLevel;
              const preservedBonus = gameState.prestigeBonus;
              
              gameState = {
                  debris: 0,
                  totalDebris: 0,
                  prestigeLevel: preservedPrestige,
                  prestigeBonus: preservedBonus,
                  spawnedDebris: 0,
                  maxDebrisLimit: 20 + (preservedPrestige * 5),
                  gameStartTime: Date.now(),
                  lastAutoCollect: 0,
                  autoCollectorCooldown: 0,
                  autoCollectorMaxCooldown: 0,
                  upgrades: {
                      collector: { level: 0, baseCost: 10, multiplier: 1.5 },
                      autoCollector: { level: 0, baseCost: 100, multiplier: 2 },
                      efficiency: { level: 0, baseCost: 500, multiplier: 2.5 },
                      scanner: { level: 0, baseCost: 1000, multiplier: 3 }
                  },
                  achievements: gameState.achievements,
                  lastSave: Date.now(),
                  gameOver: false
              };
              
              const debrisItems = document.querySelectorAll('.debris-item');
              debrisItems.forEach(item => item.remove());
              
              document.getElementById('kesslerModal').style.display = 'none';
              
              window.gameInterval = setInterval(autoCollect, 100);
              window.displayInterval = setInterval(updateDisplay, 100);
              window.spawnInterval = setInterval(spawnDebris, 2000);
              
              renderUpgrades();
              updateDisplay();
              
              showAchievement("Mission Restarted!", `Debris limit increased to ${gameState.maxDebrisLimit} pieces!`);
          }
  
          function createParticles() {
              const particlesContainer = document.getElementById('particles');
              for (let i = 0; i < 50; i++) {
                  const particle = document.createElement('div');
                  particle.className = 'particle';
                  particle.style.left = Math.random() * 100 + '%';
                  particle.style.top = Math.random() * 100 + '%';
                  particle.style.animationDelay = Math.random() * 2 + 's';
                  particle.style.animationDuration = (2 + Math.random() * 3) + 's';
                  particlesContainer.appendChild(particle);
              }
          }
  
          function checkAchievements() {
              Object.keys(achievements).forEach(key => {
                  if (!gameState.achievements.has(key)) {
                      const achievement = achievements[key];
                      let unlocked = false;
                      
                      switch (key) {
                          case 'firstDebris':
                          case 'hundred':
                          case 'thousand':
                          case 'tenThousand':
                          case 'hundredThousand':
                              unlocked = gameState.totalDebris >= achievement.threshold;
                              break;
                          case 'firstUpgrade':
                              unlocked = Object.values(gameState.upgrades).some(u => u.level >= 1);
                              break;
                          case 'firstPrestige':
                              unlocked = gameState.prestigeLevel >= 1;
                              break;
                      }
                      
                      if (unlocked) {
                          gameState.achievements.add(key);
                          showAchievement(achievement.name, achievement.description);
                      }
                  }
              });
          }
  
          function showAchievement(title, description) {
              const popup = document.getElementById('achievementPopup');
              document.getElementById('achievementText').innerHTML = `
                  <strong><i class="fas fa-trophy"></i> ${title}</strong><br>
                  ${description}
              `;
              
              popup.classList.add('show');
              setTimeout(() => {
                  popup.classList.remove('show');
              }, 4000);
          }
  
          function saveGame() {
              const saveData = {
                  ...gameState,
                  achievements: Array.from(gameState.achievements),
                  timestamp: Date.now()
              };
              
              const encrypted = btoa(JSON.stringify(saveData)).split('').reverse().join('');
              
              const blob = new Blob([encrypted], { type: 'application/octet-stream' });
              const url = URL.createObjectURL(blob);
              const a = document.createElement('a');
              a.href = url;
              a.download = `orbital-debris-save-${new Date().getTime()}.ocif`;
              a.click();
              URL.revokeObjectURL(url);
              
              showAchievement("Game Saved!", "Your progress has been saved to file.");
          }
  
          function loadGameFromFile(event) {
              const file = event.target.files[0];
              if (!file) return;
              
              const reader = new FileReader();
              reader.onload = function(e) {
                  try {
                      const decrypted = atob(e.target.result.split('').reverse().join(''));
                      const saveData = JSON.parse(decrypted);
                      
                      if (window.gameInterval) clearInterval(window.gameInterval);
                      if (window.displayInterval) clearInterval(window.displayInterval);
                      if (window.spawnInterval) clearInterval(window.spawnInterval);
                      
                      const debrisItems = document.querySelectorAll('.debris-item');
                      debrisItems.forEach(item => item.remove());
                      
                      gameState = {
                          debris: saveData.debris || 0,
                          totalDebris: saveData.totalDebris || 0,
                          prestigeLevel: saveData.prestigeLevel || 0,
                          prestigeBonus: saveData.prestigeBonus || 0,
                          spawnedDebris: 0,
                          maxDebrisLimit: saveData.maxDebrisLimit || (20 + ((saveData.prestigeLevel || 0) * 5)),
                          gameStartTime: Date.now(),
                          lastAutoCollect: Date.now(),
                          autoCollectorCooldown: 0,
                          autoCollectorMaxCooldown: 0,
                          upgrades: saveData.upgrades || {
                              collector: { level: 0, baseCost: 10, multiplier: 1.5 },
                              autoCollector: { level: 0, baseCost: 100, multiplier: 2 },
                              efficiency: { level: 0, baseCost: 500, multiplier: 2.5 },
                              scanner: { level: 0, baseCost: 1000, multiplier: 3 }
                          },
                          achievements: new Set(saveData.achievements || []),
                          lastSave: Date.now(),
                          gameOver: false
                      };
                      
                      window.gameInterval = setInterval(autoCollect, 100);
                      window.displayInterval = setInterval(updateDisplay, 100);
                      window.spawnInterval = setInterval(spawnDebris, 2000);
                      
                      updateDisplay();
                      renderUpgrades();
                      updateCollectButton();
                      updateDebrisCounter();
                      
                      document.getElementById('kesslerModal').style.display = 'none';
                      document.getElementById('prestigeModal').style.display = 'none';
                      
                      showAchievement("Game Loaded!", "Your progress has been restored and game restarted.");
                  } catch (error) {
                      console.error("Load game error:", error);
                      alert("Failed to load save file. The file may be corrupted or from an incompatible version.");
                  }
              };
              reader.readAsText(file);
              
              event.target.value = '';
          }
  
          function loadGame() {
          }
  
          function formatNumber(num, decimals = 0) {
              if (num >= 1e12) return (num / 1e12).toFixed(decimals) + 'T';
              if (num >= 1e9) return (num / 1e9).toFixed(decimals) + 'B';
              if (num >= 1e6) return (num / 1e6).toFixed(decimals) + 'M';
              if (num >= 1e3) return (num / 1e3).toFixed(decimals) + 'K';
              return num.toFixed(decimals);
          }
  
          document.addEventListener('DOMContentLoaded', initGame);
  
          window.addEventListener('click', function(event) {
              const prestigeModal = document.getElementById('prestigeModal');
              const kesslerModal = document.getElementById('kesslerModal');
              
              if (event.target === prestigeModal) {
                  hidePrestigeModal();
              }
          });
  
          function updateAutoCollectorProgress() {
              const autoCollectorCard = document.getElementById('autoCollectorCard');
              const progressFill = document.getElementById('autoCollectorProgress');
              const statusText = document.getElementById('autoCollectorStatus');
              
              if (gameState.upgrades.autoCollector.level > 0) {
                  autoCollectorCard.style.display = 'block';
                  
                  if (gameState.autoCollectorCooldown > 0) {
                      const progress = 1 - (gameState.autoCollectorCooldown / gameState.autoCollectorMaxCooldown);
                      progressFill.style.width = (progress * 100) + '%';
                      statusText.textContent = `Cooldown: ${(gameState.autoCollectorCooldown / 1000).toFixed(1)}s`;
                  } else {
                      progressFill.style.width = '100%';
                      statusText.textContent = 'Ready';
                  }
              } else {
                  autoCollectorCard.style.display = 'none';
              }
          }
      </script>
  </body>
</html>
